<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React | WW&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/assets/images/favicon.ico">
    <meta name="description" content="小万的学习日记">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.81d09c15.js" as="script"><link rel="preload" href="/assets/js/2.8398b084.js" as="script"><link rel="preload" href="/assets/js/13.4d0b052d.js" as="script"><link rel="prefetch" href="/assets/js/10.fec0f110.js"><link rel="prefetch" href="/assets/js/11.172fa010.js"><link rel="prefetch" href="/assets/js/12.614f5769.js"><link rel="prefetch" href="/assets/js/14.a6aed245.js"><link rel="prefetch" href="/assets/js/15.bf0bd6bd.js"><link rel="prefetch" href="/assets/js/16.1e1ce84e.js"><link rel="prefetch" href="/assets/js/17.5372094f.js"><link rel="prefetch" href="/assets/js/18.f7f86485.js"><link rel="prefetch" href="/assets/js/19.1243f2f5.js"><link rel="prefetch" href="/assets/js/20.028a6a0e.js"><link rel="prefetch" href="/assets/js/21.edde94d8.js"><link rel="prefetch" href="/assets/js/22.3736cae0.js"><link rel="prefetch" href="/assets/js/23.cbb27253.js"><link rel="prefetch" href="/assets/js/24.94fc5442.js"><link rel="prefetch" href="/assets/js/25.440faeee.js"><link rel="prefetch" href="/assets/js/26.64fd4f6b.js"><link rel="prefetch" href="/assets/js/27.0eca257c.js"><link rel="prefetch" href="/assets/js/28.d8486f43.js"><link rel="prefetch" href="/assets/js/29.42771179.js"><link rel="prefetch" href="/assets/js/3.521449cd.js"><link rel="prefetch" href="/assets/js/30.6200edbd.js"><link rel="prefetch" href="/assets/js/31.02ff8206.js"><link rel="prefetch" href="/assets/js/32.c40dca37.js"><link rel="prefetch" href="/assets/js/33.1355034e.js"><link rel="prefetch" href="/assets/js/34.f38a6a21.js"><link rel="prefetch" href="/assets/js/35.c540498a.js"><link rel="prefetch" href="/assets/js/36.3e7e22ca.js"><link rel="prefetch" href="/assets/js/37.b8683165.js"><link rel="prefetch" href="/assets/js/38.1c86bb9c.js"><link rel="prefetch" href="/assets/js/39.fba09886.js"><link rel="prefetch" href="/assets/js/4.3f57852d.js"><link rel="prefetch" href="/assets/js/40.4f536509.js"><link rel="prefetch" href="/assets/js/41.0508b3e6.js"><link rel="prefetch" href="/assets/js/42.c51c2847.js"><link rel="prefetch" href="/assets/js/43.93e5d495.js"><link rel="prefetch" href="/assets/js/44.45e204ef.js"><link rel="prefetch" href="/assets/js/45.1fe5400f.js"><link rel="prefetch" href="/assets/js/46.1adc7847.js"><link rel="prefetch" href="/assets/js/47.9f86d57c.js"><link rel="prefetch" href="/assets/js/5.a7ce3cbd.js"><link rel="prefetch" href="/assets/js/6.46d1b36f.js"><link rel="prefetch" href="/assets/js/7.e1e7eddb.js"><link rel="prefetch" href="/assets/js/8.8bee4585.js"><link rel="prefetch" href="/assets/js/9.56ff43bb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">WW's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/" class="nav-link router-link-active">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="/internship/" class="nav-link">
  实习日记
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试总结
</a></div><div class="nav-item"><a href="https://github.com/Elvira-wan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gitgub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/" class="nav-link router-link-active">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="/internship/" class="nav-link">
  实习日记
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试总结
</a></div><div class="nav-item"><a href="https://github.com/Elvira-wan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gitgub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/accumulate/" aria-current="page" class="sidebar-link">前端基础</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端三剑客</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前后端交互</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>主流框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/accumulate/frame/react.html" aria-current="page" class="active sidebar-link">React</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/accumulate/frame/vue.html" class="sidebar-link">vue</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>进阶部分</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react"><a href="#react" class="header-anchor">#</a> React</h1> <hr> <p></p><div class="table-of-contents"><ul><li><a href="#使用react需要引入的库">使用React需要引入的库：</a></li><li><a href="#关于虚拟dom">关于虚拟DOM：</a></li><li><a href="#jsx本质">JSX本质：</a></li><li><a href="#jsx的语法规则">JSX的语法规则：</a></li><li><a href="#组件化">组件化：</a></li><li><a href="#事件处理">事件处理：</a></li><li><a href="#组件的生命周期">组件的生命周期：</a></li><li><a href="#react脚手架">React脚手架：</a></li><li><a href="#react路由">React路由：</a></li><li><a href="#react-ui组件库-ant-design-antd">React UI组件库：ant-design (antd)</a></li><li><a href="#redux">redux</a></li><li><a href="#react-redux">react-redux：</a></li><li><a href="#react-扩展">React 扩展：</a></li></ul></div><p></p> <h3 id="使用react需要引入的库"><a href="#使用react需要引入的库" class="header-anchor">#</a> 使用React需要引入的库：</h3> <ol><li>react.js：React核心库;</li> <li>react-dom.js：提供操作DOM的react扩展库 (一定要在 1 之后引入);</li> <li>babel.min.js：解析JSX语法代码转为JS代码的库。</li></ol> <h3 id="关于虚拟dom"><a href="#关于虚拟dom" class="header-anchor">#</a> 关于虚拟DOM：</h3> <ul><li>本质上是 Object 类型的对象 (一般对象)；</li> <li>虚拟DOM的属性没有真实 DOM 那么多，因为用不上；</li> <li>虚拟DOM 最终还是会被 React 转化为 真实DOM 渲染在页面上；</li></ul> <h3 id="jsx本质"><a href="#jsx本质" class="header-anchor">#</a> JSX本质：</h3> <blockquote><p>其本质为一个 <code>React.createElement</code> 函数，接收多个参数来返回 <code>Vnode</code></p> <ol><li>第一个参数：标签名 (原生HTML标签，自定义组件)；</li> <li>第二个参数：标签属性信息 (没有属性则为 null)；</li> <li>第三个参数：子元素 (可接受多个子元素作为参数 或 子元素数组)</li></ol></blockquote> <h3 id="jsx的语法规则"><a href="#jsx的语法规则" class="header-anchor">#</a> JSX的语法规则：</h3> <ol><li><p>定义虚拟DOM时不要写引号；</p></li> <li><p>标签中如果需要混用 <strong>JS 表达式</strong>时，需要用花括号包裹；</p> <p>JS表达式：是会产生一个值的，可以放在任何一个需要值的地方；</p> <p>JS语句：if, for, switch等不会产生返回值的，如果写在花括号中会报错；</p></li> <li><p>CSS样式 的类名指定不要用 <code>class</code> 要用 <code>className</code>；</p></li> <li><p>事件绑定大小写改变：<code>onclick = &quot;demo()&quot; =&gt; onClick = {demo}</code></p></li> <li><p>内联样式，要用 <code>style=key:value}}</code> 的形式去写，外层括号表示其中要书写js语句,内层括号表示是一个对象；</p></li> <li><p>不能有多个根标签；</p></li> <li><p>标签必须闭合，要么有一对，要么自结束；</p></li> <li><p>标签首字母：</p> <ul><li>小写字母开头，则将标签转为html中同名元素，若无同名元素，则报错；</li> <li>大写字母开头，React就会渲染对应的组件，若组件没有定义，则报错；</li></ul></li></ol> <h3 id="组件化"><a href="#组件化" class="header-anchor">#</a> 组件化：</h3> <ul><li><h5 id="函数式组件"><a href="#函数式组件" class="header-anchor">#</a> 函数式组件：</h5> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 1.定义函数式组件</span>
<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是用函数定义的组件(适用于【简单组件】的定义)</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>
<span class="token comment">// 2.渲染组件到页面</span>
<span class="token comment">// 注意：这里的组件标签必须自结束或者有一对</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyComponent</span></span><span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行了 <code>ReactDOM.render</code> 之后：</p> <ol><li>React 解析组件标签，找到 MyComponent 组件；</li> <li>发现组件时使用函数定义的，随后调用该函数，将返回的虚拟DOM转化为真实DOM，随后渲染在页面上；</li></ol></li> <li><h5 id="类式组件"><a href="#类式组件" class="header-anchor">#</a> 类式组件：</h5> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 1.创建类式组件，必须继承React中的内置类</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token comment">// 被定义在MyComponent的原型链上供实例使用</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是用类定义的组件(适用于【复杂组件】的定义)</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 注意：创建类式组件三要点</span>
<span class="token comment">// 1)必须继承React中的内置类</span>
<span class="token comment">// 2)必须写 render(),且render()中必须有返回值</span>

<span class="token comment">// 2. 渲染类组件到页面</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyComponent</span></span><span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>getElementById<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行了 <code>ReactDOM.render</code> 之后：</p> <ol><li><p>React 解析组件标签，找到 MyComponent 组件；</p></li> <li><p>发现组件时使用类定义的，随后创建该类的实例，并通过该实例调用到原型上的render方法，将 render 返回的虚拟DOM转为真实DOM，最后渲染在页面中；</p></li></ol> <h5 id="组件实例的三大核心属性"><a href="#组件实例的三大核心属性" class="header-anchor">#</a> 组件实例的三大核心属性：</h5> <ul><li><p><code>State</code> (状态) ：驱动页面的数据做一些变化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 原生写法</span>
 <span class="token keyword">class</span> <span class="token class-name">Weather</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
     <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// 设置状态，以动态显示数据</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> 
             isHot<span class="token operator">:</span> <span class="token boolean">true</span>
         <span class="token punctuation">}</span><span class="token punctuation">;</span>
         <span class="token comment">// bind()的作用是将this.changeWeather(类原型链上的)复制一份</span>
         <span class="token comment">// 并将该复制份的this指向当前构造函数的实例this</span>
         <span class="token comment">// 最后将该复制份写在实例的changeWeather中</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>changeWeather <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeWeather</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">// 返回虚拟DOM</span>
     <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">let</span> isHot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isHot<span class="token punctuation">;</span>
         <span class="token comment">// 这里点击事件的函数不能写调用后的，因为会直接执行，changeWeather应该作为回调函数</span>
         <span class="token comment">// 这里点击事件的changeWeather实际调用的是bind()复制的即实例的changeWeather</span>
         <span class="token keyword">return</span> <span class="token operator">&lt;</span>h2 onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeWeather<span class="token punctuation">}</span><span class="token operator">&gt;</span>今天的天气很<span class="token punctuation">{</span>isHot <span class="token operator">?</span> <span class="token string">'炎热'</span> <span class="token operator">:</span> <span class="token string">'寒冷'</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
     <span class="token punctuation">}</span>
     <span class="token function">changeWeather</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// 此时如果直接写会报错 state is undefined，因为changeWeather被点击事件调用时this在严格模式下指向undefined</span>
         <span class="token comment">// 因此在构造器中书写语句，更改this指向</span>
         <span class="token comment">// this.state.isHot =  this.state.isHot ? false : true;     // 错误！！！</span>
         <span class="token comment">// 注意：state不可以直接更改，需要通过React.Component的内置API setState() 更改</span>
         <span class="token comment">// 因此写做：</span>
         <span class="token comment">// 1. 因为在setState参数中书写的是对象因此需要用花括号包裹</span>
         <span class="token comment">// 2. 前面的isHot是 this.state的属性名，无需加this.state, 后面的是值，需要通过this.state.isHot获取</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>isHot<span class="token operator">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isHot<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isHot<span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><p><strong>注意</strong>：</p> <ol><li><p><code>state</code> 应该书写做一个对象；</p></li> <li><p>在React中绑定事件通常使用直接绑定在标签内的方式，且写法改为 <code>onClick = {this.事件函数的声明}</code>，注意花括号中不能写事件函数的调用；</p></li> <li><p><code>setState()</code>：在事件中是无法直接改变类组件的 <code>state</code> 的，只能通过 <code>this.setState()</code> 方法来改变组件的状态，且在该方法只会对的参数中书写的属性名进行覆盖，而不会直接对整个 <code>state</code> 的值进行覆盖；</p></li> <li><p>因为在  <code>changeWeather</code> 中书写的 <code>this</code> 在被调用时是 <code>undefined</code> 因此需要在构造器中将 <code>changeWeather</code> 复制一份，且改变其 <code>this</code> 保存在实例中，以供实例调用；</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 简写state</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token comment">// 写构造器是为了重写state的属性并且绑定点击事件的this</span>
    <span class="token comment">// 但是由于这两个属性是属于每一个组件的实例</span>
    <span class="token comment">// 因此可以把这些写在构造器外部，即简写state</span>
    <span class="token comment">// 在构造器外部写属性必须使用赋值语句</span>
    state <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>isHot<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> wind<span class="token operator">:</span> <span class="token string">'微风'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>h2 onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeWeather<span class="token punctuation">}</span><span class="token operator">&gt;</span>今天的天气很<span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isHot <span class="token operator">?</span> <span class="token string">'炎热'</span> <span class="token operator">:</span> <span class="token string">'凉爽'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>wind<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 因为箭头函数本身没有this而会去函数定义处的外部找this</span>
    <span class="token function-variable function">changeWeather</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>isHot<span class="token operator">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isHot<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>Props</code>：可以存储渲染组件时在标签中传入的一些数据，并在组件内容中显示</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 导入关键包 prop-type 库</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/prop-types.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
     <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// 解构复制获取几个属性的值</span>
         <span class="token comment">// 该语句不能直接写在类中，会报错</span>
         <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span>
         <span class="token keyword">return</span> <span class="token punctuation">(</span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">姓名：</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">年龄：</span><span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">性别：</span><span class="token punctuation">{</span>sex<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
             </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>  
         <span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token comment">// 对类中props中数据的类型进行限定，写在类外部</span>
MyComponent<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// name: React.PropTypes.string.isRequired		// 该React.PropTypes在React 15.5中已被弃用，使用以下方法；</span>
   
    name<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>      <span class="token comment">// 限制该值为string类型，且为必填</span>
    age<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
    sex<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
    speak<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 给Props中的数据设置默认值</span>
MyComponent<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    sex<span class="token operator">:</span> <span class="token string">'male'</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注意</strong>：</p> <ol><li>要先导入proptype 库，由此引入一个新的对象 <code>PropTypes</code>;</li> <li>使用 <code>PropTypes.类型</code> 来规定传入值的类型，在此类型必须为全小写 (<code>number/string/boolean/func...</code>)；</li> <li><code>isRequired</code> 表示该传入值为必须填写的；</li> <li><code>propTypes</code> 和 <code>defualtProps</code>：是对设置在类本身，从而对 <code>Props</code> 进行限制，而不是设置在类的每个实例上；</li></ol> <p>简写 <code>prop</code>：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">姓名：</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">年龄：</span><span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">性别：</span><span class="token punctuation">{</span>sex<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// 因为props默认值和props所需属性是定义在类本身的，因此也可以使用static关键字将其定义在类中</span>
    <span class="token comment">// 这样就不用定义在类外部，尽量将组件一体化</span>
    <span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
        age<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
        sex<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>string
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果设置了isRequired属性默认值不会生效</span>
        <span class="token comment">// name: 'WW',</span>
        age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
        sex<span class="token operator">:</span> <span class="token string">'female'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>构造器是否接收 <code>Props</code>，是否传递给 <code>super()</code>，取决于是否希望在构造器中使用 <code>this.props</code> 去获取 <code>props</code> 的值；</p> <p>函数式组件使用 <code>props</code>：给</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token function">retrun</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">姓名：</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">性别：</span><span class="token punctuation">{</span>sex<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">年龄：</span><span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 并使用类原始的限制方法， 可以对传入的值进行限制</span>
Person<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">.</span>isrequired<span class="token punctuation">,</span>
    age<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
    sex<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>string
<span class="token punctuation">}</span>
<span class="token comment">// 赋默认值</span>
Person<span class="token punctuation">.</span>deaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    sex<span class="token operator">:</span> <span class="token string">'female'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在函数定义的组件中虽然没有实例化的 <code>this</code> ，但是可以通过 <code>props</code> 参数来接收到组件标签中所传递的属性，并自动归类为一个对象；</p></li> <li><p><code>refs</code>：渲染组件时在标签中书写 <code>ref</code> 属性，会自动保存在类组件的 <code>refs</code> 中，在 <code>refs</code> 中其属性名为 <code>ref</code> 属性的值，属性值为书写该 <code>ref</code> 的<code>DOM</code>节点；</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code> <span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
            
     <span class="token comment">// 3-1. 调用API创建一个容器，该容器能且仅能存放一个ref</span>
     myRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token function-variable function">submitData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(this.refs)</span>
        <span class="token comment">// ref中存储了两个键值对</span>
        <span class="token comment">// 其名为ref的属性值，其值为ref对应的DOM元素</span>
        <span class="token comment">// 如果定义了两个同名的ref，后面的会把前面的覆盖掉</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>input1<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function-variable function">submitData2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>input2<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function-variable function">submitData3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(this.myRef);</span>
        <span class="token comment">// 上面语句会输出一个对象，里面只包含一个值，{current:input}</span>
        <span class="token comment">// 该值的属性名为系统指定 current 无法更改，该对象的属性值为 当前DOM节点</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>myRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span><span class="token comment">/* 1. 字符串定义ref的方式(已弃用) */</span><span class="token punctuation">}</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>input1<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text"> &amp;nbsp;
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>submitData<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">点击提交左侧数据</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> &amp;nbsp;
                
                </span><span class="token punctuation">{</span><span class="token comment">/* 2. 回调函数定义ref，该回调函数被系统自动调用，其会接收到一个参数，该参数就是当前回调函数所在的DOM节点 */</span><span class="token punctuation">}</span><span class="token plain-text">
                &lt;input type='text' ref= </span><span class="token punctuation">{</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input2 <span class="token operator">=</span> c<span class="token punctuation">}</span><span class="token plain-text"> onBlur=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>submitData2<span class="token punctuation">}</span><span class="token plain-text">/&gt;&amp;nbsp;
                </span><span class="token punctuation">{</span><span class="token comment">/* 回调函数ref作为内联样式绑定在标签上的时候，如果页面有更新会导致ref被触发两次第一次值为null，第二次值才为DOM元素，因此可以使用class绑定的方式 */</span><span class="token punctuation">}</span><span class="token plain-text">

                </span><span class="token punctuation">{</span><span class="token comment">/* 3. 新API creatRef 创建定义ref(最推荐使用)*/</span><span class="token punctuation">}</span><span class="token plain-text">
                &lt;input type='text' ref= </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>myRef<span class="token punctuation">}</span><span class="token plain-text"> onBlur=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>submitData3<span class="token punctuation">}</span><span class="token plain-text">/&gt;    

            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>三种方式定义 <code>ref</code>：</p> <ol><li>直接用字符串类型定义；</li> <li>使用回调函数 <code>c =&gt; this.name = c</code> ，c 就表示当前设置该 ref 的节点，特别注意这里的节点是保存在类组件的实例中的，并非在refs中；</li> <li>使用新的 API，<code>const name = new CreateRef()</code> 创建容器，后使用 <code>ref = {this.name}</code> 将当前DOM节点存入容器，使用该方法时，属性名是被指定为 <code>current</code> 的，且无法更改；</li></ol> <p><strong>注意</strong>：尽量少用 refs 这样会打破组件的封装；</p></li></ul></li></ul> <h3 id="事件处理"><a href="#事件处理" class="header-anchor">#</a> 事件处理：</h3> <ul><li><p>通过 <code>onXxx</code> 属性指定事件处理函数：</p> <ol><li>React使用自定义 (合成) 事件，而不是原生的 DOM 事件 ——是为了更好的兼容性</li> <li>React事件通过事件委托的方式处理 (委托给组件最外层的元素) ——是为了高效；</li></ol></li> <li><p>通过 <code>event.target</code> 得到发生事件的 DOM元素的对象：</p> <p>因为 React 要求尽量不要过度使用 <code>ref</code>，若在所操作的元素与所要获取的元素是同一元素时，可以使用 <code>event.target</code></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token punctuation">{</span><span class="token comment">/*上述ref案例中的失去焦点事件就可以被改为以下形式*/</span><span class="token punctuation">}</span>
<span class="token function">submitData2</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onBlur</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>submitData2<span class="token punctuation">}</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">placehold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>失去焦点提交数据<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>受控组件：现取现用，即时反馈数据；</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">submitData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>username<span class="token punctuation">,</span> password<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">受控组件 ———— 用户名：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>username<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，密码：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>password<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.baidu.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>submitData<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> c<span class="token punctuation">}</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>username<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> c<span class="token punctuation">}</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>password<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>password<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">登录</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意：</p> <ol><li>使用<strong>回调函数存储 <code>ref</code> 时，是将 <code>ref</code> 存储在当前类组件的实例中，而非存储在 <code>this.ref</code> 中</strong>；</li></ol></li> <li><p>非受控组件：将每一次的值提取出来，存在状态中，需要用的时候提取出来；</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code> <span class="token keyword">class</span> <span class="token class-name">OtherComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
     <span class="token comment">// 初始化state中内容</span>
     state <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
         username<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
         password<span class="token operator">:</span> <span class="token string">''</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 提交表单绑定函数</span>
    <span class="token function-variable function">submitData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>username<span class="token punctuation">,</span> password<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">非受控组件 ———— 用户名：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，密码：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>password<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 输入框内容改变事件绑定函数</span>
    <span class="token function-variable function">saveState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dataName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 因为此时该函数不再是被onChange绑定且调用的事件函数了，那么此时传入的参数也不再是event，而是由用户传入的参数</span>
        <span class="token comment">// console.log(dataName);</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 因为这个函数是onChange直接调用的函数，则该函数可以接收到参数 event</span>
            <span class="token comment">// this.state.[dataName] = e.target.value;      // 报错：这里的state不可以直接设置，必须使用内置API setState()</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">[</span>dataName<span class="token punctuation">]</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>submitData<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span><span class="token comment">/*注意：因为saveState已经被用户自主调用，因此这里的onChange得到的是saveState的返回值*/</span><span class="token punctuation">}</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveState</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveState</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">登录</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意：</p> <ol><li><p><code>onChange</code> 绑定事件中，因为 <code>savaState</code> 已经被用户自主调用了，因此 <code>onChange</code> 绑定的是该函数的返回值，而不是该函数；</p></li> <li><p>因为 <code>saveState</code> 是被用户调用的，因此传入的参数也不是 <code>event</code>，而是用户自主传入的参数，<code>saveState</code> 的返回值函数传入的参数才是 <code>event</code>；</p></li></ol> <p>拓展高阶函数的概念：</p> <blockquote><p>有两类高阶函数，只要满足以下两个条件之一，就称为高阶函数：</p> <ol><li><p>参数是函数；</p></li> <li><p>返回值是函数；</p></li></ol> <p>如上的 <code>saveState</code> 就是第二种类型的高阶函数；</p></blockquote> <p>函数的柯里化：</p></li></ul> <h3 id="组件的生命周期"><a href="#组件的生命周期" class="header-anchor">#</a> 组件的生命周期：</h3> <blockquote><p>组件从创建到死亡它会经历一些特定的阶段；</p> <p>组件在生命的每个时间点，都有自定义的回调函数 (钩子函数 / 生命周期钩子) ，会在特定的时刻调用；</p> <p>我们在定义组件时，会在特定的生命周期回调函数中，做特定的工作。</p></blockquote> <ul><li>旧版本的生命周期图</li></ul> <p><img src="/assets/img/image-20210622171412184.3bf0de47.png" alt="image-20210622171412184"></p> <ul><li><p>初始化阶段：由 <code>ReactDOM.render()</code> 触发---初次渲染</p> <ol><li><p><code>constructor()</code></p></li> <li><p><code>componentWillMount()</code></p></li> <li><p><code>render()</code></p></li> <li><p><strong><code>componentDidMount()</code></strong></p> <p>一般在这个钩子中初始化：开定时器，发送网络请求、订阅消息；</p></li></ol></li> <li><p>更新阶段：由组件内部 <code>this.setSate()</code> 或 父组件重新 <code>render</code> 触发</p> <ol><li><p><code>shouldComponentUpdate()</code></p></li> <li><p><code>componentWillUpdate()</code></p></li> <li><p><code>render()</code></p></li> <li><p><code>componentDidUpdate()</code></p></li></ol></li> <li><p>卸载组件：由 <code>ReactDOM.unmountComponentAtNode()</code> 触发</p> <ol><li><p><code>componentWillUnmount()</code></p> <p>一般在这个钩子中收尾：关闭定时器，取消订阅；</p></li></ol></li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 单个正常组件流程</span>
<span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token comment">// 构造器</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1. Count---constructor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            num<span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 事件绑定函数</span>
    <span class="token function-variable function">changeNum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> num <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
        num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> num <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function-variable function">force</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 强制更新不需要经过更新阀门 shouldComponentUpdate()</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function-variable function">unload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        ReactDOM<span class="token punctuation">.</span><span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// componentWillMount() 组件即将挂载时被调用</span>
    <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2. Count---componentWillMount'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// componentDidMount() 组件挂载完成时被调用</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4. Count---componentDidMount'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 更新状态阀门，如果不设置则返回值自动为true，如果设置则返回值必须为布尔值，若返回值为false则拒绝更新状态</span>
    <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5. Count---shouldComponentUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 若不设置返回值，报错：Count.shouldComponentUpdate(): Returned undefined instead of a boolean value.</span>
        <span class="token comment">// return false;       // 状态值不会被改变</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 状态即将更新</span>
    <span class="token function">componentWillUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'6. Count---componentWillUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 状态更新完毕</span>
    <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'7. Count---componentDidUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 卸载组件</span>
    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'8. count---componentWillUnmount'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 挂载组件 和 状态更新时被调用</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3. Count---render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">计数器：</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>num<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeNum<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+ 1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> &amp;nbsp;&amp;nbsp;
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>unload<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">卸载</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> &amp;nbsp;&amp;nbsp;
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>force<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">点我强制更新状态</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    	<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意：</p> <ul><li><p>组件被挂载在页面上的流程：<code>1 --&gt; 2 --&gt; 3 --&gt; 4</code></p></li> <li><p>组件被 <code>setState()</code>  后的流程：<code>5 --&gt; 6 --&gt; 3 --&gt; 7</code></p> <p>此时更新状态通过了更新阀门，即 <code>shouldComponentUpdate()</code>，若不自主设定时，默认 <code>return true</code>，若设定时，则必须设定返回值为布尔值，否则报错；若设定 <code>return false</code>，则拒绝用户更新 <code>state</code>；</p></li> <li><p>组件被 <code>forceUpdate</code> 后的流程：<code>6 --&gt; 3 --&gt; 7</code></p> <p>强制更新时，无需经过更新阀门，此时无论更新阀门返回值为何，都将在不改变状态值的情况下，对 <code>state</code> 进行强制刷新；</p></li> <li><p>组件即将被卸载的流程：<code>8</code></p></li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 父子关系组件更新流程</span>
<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span>
        car<span class="token operator">:</span> <span class="token string">'minicoper'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function-variable function">changeCar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// let {car} = this.state;      </span>
        <span class="token comment">// 因为这里不需要对state做计算或者判断，因此无需赋值</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> car<span class="token operator">:</span> <span class="token string">'aoto'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 更新阀门</span>
    <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1. A---shouleComponentUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 即将更新</span>
    <span class="token function">componentWillUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2. A---componentWillUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 更新完成</span>
    <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'9. A---componentDidUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3. A---render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">这是A组件</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeCar<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">点击换车</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">B</span></span> <span class="token attr-name">car</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>car<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token comment">// 子组件即将接收父组件的数据</span>
    <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4. B---componentWillReceiveProps'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 更新阀门</span>
    <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5. B---shouleComponentUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// return false;       </span>
        <span class="token comment">// 若A组件设置为true B组件设置为false</span>
        <span class="token comment">// 则A组件会改变状态值，B组件不会接收, 执行顺序为 1-2-3-4-5-9</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 即将更新</span>
    <span class="token function">componentWillUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'6. B---componentWillUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 更新完成</span>
    <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'8. B---componentDidUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'7. B---render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">这是B组件，car：</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>car<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注意</strong>：</p> <ul><li><p>A，B组件的更新阀门都 <code>renturn true</code>：<code>1 --&gt; 2 --&gt; 3 --&gt; 4 --&gt; 5 --&gt; 6 --&gt; 3 --&gt; 7 --&gt; 8 --&gt; 9</code></p> <p>A组件安装 <code>setState()</code> 更新流程执行，直到 <code>render()</code>，然后将值通过 <code>props</code> 传给 B组件，开始执行 B组件 的更新流程，但是由于需要接收 A组件传过来的值，因此在正常的 <code>steState()</code> 之前多了一个 <code>componentWillReceiveProps()</code>，最后 B组件 正常更新步骤执行完毕后，才执行 A组件钩子函数 <code>componentDidUpdate()</code>;</p></li> <li><p>A组件更新阀门为 <code>true</code>，B组件更新阀门为 <code>false</code>：<code>1 --&gt; 2 --&gt; 3 --&gt; 4 --&gt; 5 --&gt; 9</code></p> <p>此时 A组件中 状态更新完成，但是 B组件 更新阀门关闭，拒绝接收任何，因此没有执行更新的钩子函数；</p></li> <li><p>新版本生命周期图：</p> <p><img src="/assets/img/image-20210623123048848.bdf543d0.png" alt="image-20210623123048848"></p></li> <li><p>废弃了三个钩子：</p> <ol><li><code>componentWillReceiveProps()</code></li> <li><code>componentWillMount()</code></li> <li><code>componentWillUpdate()</code></li></ol> <p>在新版本的 React 中，想使用这三个钩子必须加上 <code>UNSAFE_</code> 前缀，否则会报警告；</p></li> <li><p>提出了两个新钩子：</p> <ol><li><p><code>getDerivedStateFromProps()</code></p> <p>不定义在实例上，定义在类原型上，则用 <code>static</code> 定义；</p> <p>有返回值，且返回值为 <code>null</code>，或者一个状态对象；</p> <p>如果返回值为一个状态对象的话，页面中映射的状态对象则将变更为当前返回值，且无法再由 <code>setState</code> 修改；</p> <p>此方法用于 <code>state</code> 完全由 <code>props</code> 决定时，但是尽量避免这样使用；</p></li> <li><p><code>getSnapshotBeforeUpdate()</code>：用于在页面更新之前捕获一些页面有关数据；</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code> <span class="token keyword">class</span> <span class="token class-name">List</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
     state <span class="token operator">=</span> <span class="token punctuation">{</span>
         arr<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 这样定义是错误的，因为state中没有一个状态名为 arr[arr.length],</span>
            <span class="token comment">// this.setState({arr[arr.length]: `新闻${arr.length + 1}`});</span>
            <span class="token comment">// 因此使用以下写法</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span>arr<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
            <span class="token keyword">const</span> news <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">新闻</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>arr<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>arr<span class="token operator">:</span> <span class="token punctuation">[</span>news<span class="token punctuation">,</span> <span class="token operator">...</span>arr<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 在更新之前捕获页面的一些数据</span>
    <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在该案例中，可以用于页面添加数据，但是滚动条不滚动</span>
        <span class="token comment">// ScrollTop用于获取页面已卷动高度，ScrollHeight表示页面总高度</span>
        <span class="token keyword">const</span> top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>list<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
        <span class="token keyword">const</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>list<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 该方法的返回值会传给 componentDidUpdate(prevprop, prevstate, snapshot) 中的snapshot参数;</span>
        <span class="token comment">// 因此该方法会与 componentDidUpdate() 结合使用</span>
        <span class="token keyword">return</span> height<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProp<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> snapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(prevProp, prevState,snapshot);</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>list<span class="token punctuation">.</span>scrollTop <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>list<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> snapshot<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>news-list<span class="token punctuation">'</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>list<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// map方法会自动接收两个参数，item: 遍历数组的当前项，index：当前项的索引</span>
                    <span class="token comment">// 注意：遍历数组时，要给每个遍历返回的标签写上对应的key</span>
                    <span class="token comment">// 否则报警告：arning: Each child in a list should have a unique &quot;key&quot; prop.</span>
                    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">// 此时更新内容会动态的反馈在页面上</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token plain-text">
    		</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    	<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">List</span></span><span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意：</p> <ol><li>如果在状态中定义一个数组，那么如果需要不停的向数组中加入数据，就可以采用扩展运算符的形式；</li> <li>对象的必须解构赋值给对象，而非其他类型，否则报错；</li> <li><code>scrollTop</code> 表示页面已卷动高度，<code>scrollHeight</code> 表示页面总高度；</li> <li><code>getSnapshotBeforeUpdate()</code> 一般配合 <code>componentDidUpdate(prevProps, prevState, snapshot)</code> 使用，前者的返回值是后者的第三个参数；</li> <li>如果类组件中的标签需要通过遍历获得，则必须给每个遍历获得的元素添加其唯一的 <code>key</code> 属性；</li> <li>遍历数组并将其改写为标签形式一般使用 <code>arr.map(item, index)</code> 方法，该方法参数为一个函数，函数中书写需要对遍历到的每一项做何种操作，且该方法不会改变原数组，而是会返回一个新的数组；</li></ol></li></ol></li></ul> <h3 id="react脚手架"><a href="#react脚手架" class="header-anchor">#</a> React脚手架：</h3> <blockquote><p>用来帮助程序员快速创建一个基于React库的模板项目：</p> <ol><li>包含了所有需要的配置 (语法检查、jsx编译、devServer)；</li> <li>下载好了所有相关的依赖；</li> <li>可以直接运行一个简单的效果；</li></ol> <p>React提供了一个用于创建react项目的脚手架库: create-react-app；</p> <p>项目的整体技术架构为:  react + webpack + es6 + eslint；</p> <p>使用脚手架开发的项目的特点: 模块化,，组件化，工程化；</p></blockquote> <ul><li><p>搭建脚手架步骤：</p> <ol><li><p>全局安装：<code>npm install -g create-react-app</code>；</p></li> <li><p>切换到创建项目的目录，cmd输入命令：<code>create-react-app hello-react</code>；</p></li> <li><p>进入项目文件夹：<code>cd hello-react</code>;</p></li> <li><p>启动项目：<code>npm start</code>；</p></li></ol></li> <li><p>脚手架项目结构：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>public ---- 静态资源文件夹
    favicon.icon ------ 网站页签图标
    index.html -------- 主页面
    logo192.png ------- logo图
    logo512.png ------- logo图
    manifest.json ----- 应用加壳的配置文件
    robots.txt -------- 爬虫协议文件
    
    
src ---- 源码文件夹
    App.css -------- App组件的样式
    App.js --------- App组件
    App.test.js ---- 用于给App做测试
    index.css ------ 样式
    index.js ------- 入口文件
    logo.svg ------- logo图
    reportWebVitals.js --- 页面性能分析文件(需要web-vitals库的支持)
    setupTests.js ---- 组件单元测试的文件(需要jest-dom库的支持)
</code></pre></div><p>其中较为重要的三个文件：</p> <ol><li><code>index.html</code>  —— 主页面；</li> <li><code>App.js</code> —— APP组件，也是 root 中唯一渲染的组件，其余子组件都渲染在 App 组件中；</li> <li><code>index.js</code> —— 入口文件，在此文件中书写将 <code>App.js</code> 渲染到主页面 <code>index.html</code> 的语句；</li></ol></li> <li><h4 id="react脚手架配置代理总结"><a href="#react脚手架配置代理总结" class="header-anchor">#</a> react脚手架配置代理总结</h4> <p>方法一：</p> <blockquote><p>在package.json中追加如下配置</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;proxy&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://localhost:5000&quot;</span>
</code></pre></div><p>说明：</p> <ol><li><p>优点：配置简单，前端请求资源时可以不加任何前缀。</p></li> <li><p>缺点：不能配置多个代理。</p></li> <li><p>工作方式：上述方式配置代理，当请求了3000不存在的资源时，那么该请求会转发给5000 （优先匹配前端资源）</p></li></ol> <p>方法二：</p> <ol><li><p>第一步：创建代理配置文件</p> <div class="language- extra-class"><pre class="language-text"><code>在src下创建配置文件：src/setupProxy.js
</code></pre></div></li> <li><p>编写setupProxy.js配置具体代理规则：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
    <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">'/api1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  <span class="token comment">//api1是需要转发的请求(所有带有/api1前缀的请求都会转发给5000)</span>
      target<span class="token operator">:</span> <span class="token string">'http://localhost:5000'</span><span class="token punctuation">,</span> <span class="token comment">//配置转发目标地址(能返回数据的服务器地址)</span>
      changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//控制服务器接收到的请求头中host字段的值</span>
      <span class="token comment">/*
      	changeOrigin设置为true时，服务器收到的请求头中的host为：localhost:5000
      	changeOrigin设置为false时，服务器收到的请求头中的host为：localhost:3000
      	changeOrigin默认值为false，但我们一般将changeOrigin值设为true
      */</span>
      pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'^/api1'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span> <span class="token comment">//去除请求前缀，保证交给后台服务器的是正常请求地址(必须配置)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">'/api2'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> 
      target<span class="token operator">:</span> <span class="token string">'http://localhost:5001'</span><span class="token punctuation">,</span>
      changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'^/api2'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <p>说明：</p> <ol><li><p>优点：可以配置多个代理，可以灵活的控制请求是否走代理。</p></li> <li><p>缺点：配置繁琐，前端请求资源时必须加前缀。</p></li></ol></li> <li><h4 id="消息订阅-发布机制-实现兄弟组件间通信"><a href="#消息订阅-发布机制-实现兄弟组件间通信" class="header-anchor">#</a> 消息订阅-发布机制：实现兄弟组件间通信</h4> <ol><li><p>下载 <code>npm install pubsub-js --save</code>；</p></li> <li><p>引入包：<code>import PubSub from 'pubsub-js'</code>；</p></li> <li><p>订阅消息：<code>let token = PubSub.subscribe('delete', (msg, data) =&gt; { })</code></p> <p>第一个参数：消息名</p> <p>第二个参数：函数(消息名， 消息数据)</p></li> <li><p>发布消息：<code>PubSub.publish('delete', data)</code> ；</p></li> <li><p>取消订阅：<code>PubSub.unsubscribe(token)</code></p></li></ol></li></ul> <h3 id="react路由"><a href="#react路由" class="header-anchor">#</a> React路由：</h3> <blockquote><p>路由是一个 <code>(key: value)</code> 的映射关系，key为传给 url 的路径，value 为 function 或 component；</p></blockquote> <ul><li><p>后端路由：</p> <ol><li>理解：value是function, 用来处理客户端提交的请求。</li> <li>注册路由： <code>router.get(path, function(req, res))</code></li> <li>工作过程：当node接收到一个请求时, 根据请求路径找到匹配的路由, 调用路由中的函数来处理请求, 返回响应数据</li></ol></li> <li><p>前端路由：</p> <ol><li>浏览器端路由，value是component，用于展示页面内容。</li> <li>注册路由:  <code>&lt;Route path=&quot;/test&quot; component={Test}&gt;</code></li> <li>工作过程：当浏览器的path变为 /test 时, 当前路由组件就会变为Test组件</li></ol></li> <li><p>基本使用：</p> <ol><li>安装 <code>react-router-dom</code>：<code>npm install --save react-router-dom</code>;</li> <li>在 App.jsx 中引入，<code>Link</code> 组件，用来向地址栏传递 <code>path</code>，<code>&lt;Link to='/name'&gt;</code></li> <li>在展示区将需要展示的组件用 <code>&lt;Route&gt;</code> 组件书写，<code>&lt;Route path='/name' component={ComponentName}&gt;</code></li></ol> <p>特别地，以上两个通过 <code>react-router-dom</code> 引入的组件需要被 <code>&lt;BrowserRouter&gt;&lt;/BrowserRouter&gt;</code> 包裹，该标签最好直接书写在 <code>index.js</code> 中，在 <code>ReactDom.render()</code> 渲染时，直接包裹 <code>&lt;App/&gt;</code> 标签；</p></li> <li><p>路由组件和一般组件：</p> <ol><li><p>写法不同：</p> <p>一般组件：<code>&lt;Demo/&gt;</code></p> <p>路由组件：<code>&lt;Route path='/demo' component={Demo} /&gt;</code></p></li> <li><p>存放位置不同：</p> <p>一般组件：component 文件夹中</p> <p>路由组件：pages 文件夹中</p></li> <li><p>接收到的 props 不同：</p> <p>一般组件：书写标签时传什么就接受到什么</p> <p>路由组件：接收到三个固定属性</p> <p>​					history：</p> <p>​							-- go</p></li></ol></li> <li><p><code>NavLink</code> 与 封装的 <code>MyNavLink</code></p> <ol><li><p>NavLink 可以实现路由链接的高亮，默认样式名为 <code>active</code>，可通过 <code>activeClassName</code> 指定其他样式名；</p></li> <li><p>标签体内容是一个特殊的标签属性 <code>children</code>;</p></li> <li><p>通过 this.props.children 可以获取标签体的内容；</p></li></ol></li> <li><p>switch 的使用：</p> <blockquote><p>用于注册路由时，一个路径匹配多个组件，为了提高效率，引入 <code>&lt;Switch&gt;</code> 组件将 <code>&lt;Link&gt;</code> 包裹起来，此时如果再出现一个路径匹配多个路由的状况，则只读取展示第一个组件；</p></blockquote></li> <li><p>样式丢失：当Link需要跳转去一个二级以上路由时，url改变后，再次刷新页面，原先引入的样式会因为错认url地址而无法显示</p> <p>三个解决方法：</p> <ol><li><p>将引入样式路径前的 . 删掉；</p></li> <li><p>在引入样式路径前加上 <code>%pubilic_URL%</code></p></li> <li><p>使用 <code>HashRouter</code> ，因为该路由器会在地址栏后面加入 # ，# 后的内容不被识别 (少用)</p></li></ol></li> <li><p>精准匹配与模糊匹配：</p> <blockquote><p>当 Link 填写的内容与 Route 不完全一致时：</p> <p>模糊匹配：如果Route中含有Link的内容，且顺序一致，则在模糊匹配时可显示内容；</p> <p>精准匹配：则需要两个 path 完全一直，才会显示内容；</p></blockquote> <p>在 Route 标签中加入 exact 关键字 则为路由开启严格匹配，但并不建议开启严格匹配，因为开启后可能会导致二级路由无法跳转；</p></li> <li><p><code>&lt;Redirect&gt;</code> 组件：</p> <blockquote><p>相当于给页面定一个主页，即一开始就显示的页面；</p></blockquote> <p>写法：<code>&lt;Redirect to='/pathName'&gt;</code></p> <p>一般写在所有路由的最后，作为兜底；</p></li> <li><p>嵌套路由：在一个路由组件中又有导航区和展示区，需要跳转到其他路由组件，以此构成层层嵌套的关系</p> <p>在不同的路由组件中传递参数的三种方式：</p> <ol><li><p><code>params</code>：</p> <p>使用 Link 传递时将想传的参数书写在 path 后，eg：<code>/home/message/${id}/${title}</code>;</p> <p>使用 Route 接收时在 path 后添加需要接收的参数名，eg：<code>/home/message/:id/:title</code></p> <p>如上，id 与 title 参数就会通过 props 传入路由组件中，并被自动解析成为一个对象，存放在 <code>this.props.match.params</code> 中；</p></li> <li><p><code>search</code>：</p> <p>使用 Link 传递时将想传的参数书写在 path 后，eg：<code>/home/message/？id=${id}&amp;title=${title}</code>;</p> <p>在 Route 中无需声明接收；</p> <p>存放在路由组件中的 <code>this.props.location.search</code>，但是其储存形式为字符串直接截取了url中，问号及其后面的值，称其为 <code>urlencoded</code> 编码；</p> <p>此时为了将 <code>urlencoded</code> 转换为对象，需要使用react的内置库 <code>querystring</code> 中的对象来操作，<code>qs.stringify(obj)</code> 是将对象转换为 url，<code>qs.parse(encoded)</code> 是将 url 转换为对象；</p></li> <li><p><code>state</code>：</p> <p>Link 标签中 to 的值改为对象形式 ,eg：<code>{pathname: '/home/message', state: {id: id, title: title}}</code>；</p> <p>在 Route 中无需声明接收；</p> <p>此时参数作为一个对象，存储在 <code>this.props.location.state</code> 中；</p> <p>注意：因为这里的地址栏中不显示参数，因此内容的显示是靠着浏览器的 history 维护的，此时如果清除浏览器缓存，则会报错，无法从  <code>this.props.location.state</code>  解构出 id，title 的值，因此可以写作 <code>const {id, title} = this.props.location.state || {}</code>，则不报错；</p></li></ol></li> <li><p>push模式与replace模式</p> <blockquote><p>浏览器的 history 类似一个栈，当 url 不断地切换时，浏览过的页签会被不断地推入栈中，当前的页面永远都是栈顶元素；</p> <p>push 模式是路由的默认模式，其作用就是不断地把访问的页面推到栈顶；</p> <p>replace 模式，需要在 Link 标签中书写一个 replace 才会启开，启开 replace 模式的页签在被点击时会自动替换栈顶元素，如果每个页签都启用 replace 模式，则浏览器不会留下任何访问痕迹；</p></blockquote></li> <li><p>编程式路由导航：原理是利用 history 自身携带的三个 API (<code>go(n)</code>，<code>goForward</code>，<code>goBack</code>)</p> <p>特别地，一般组件的 this.props 中并没有 history，因此也没有以上三个 API，那么想要<strong>在一般组件中使用路由组件的 API 就需要引入 <code>withRouter</code></strong> 并在暴露该组件时，将其用 <code>withRouter()</code> 包裹，写做 <code>defualt export withRouter(Component)</code>，因此也可知 <code>withRouter()</code> 的返回值是一个新组件；</p></li> <li><p><code>BrowseRouter</code> 与 <code>HashRouter</code> 的区别</p> <ol><li><p>底层原理不一样</p> <ul><li><code>BrowserRouter</code> 使用的是H5的 history API，不兼容IE9及以下版本</li> <li><code>HashRouter</code> 使用的是URL的哈希值。</li></ul></li> <li><p>path表现形式不一样</p> <ul><li><code>BrowserRouter</code> 的路径中没有#,例如：localhost:3000/demo/test</li> <li><code>HashRouter</code> 的路径包含#,例如：localhost:3000/#/demo/test</li></ul></li> <li><p>刷新后对路由state参数的影响</p> <ul><li><code>BrowserRouter</code> 没有任何影响，因为state保存在history对象中。</li> <li><code>HashRouter</code> 刷新后会导致路由state参数的丢失！！！</li></ul> <p>备注：HashRouter可以用于解决一些路径错误相关的问题。</p></li></ol></li></ul> <h3 id="react-ui组件库-ant-design-antd"><a href="#react-ui组件库-ant-design-antd" class="header-anchor">#</a> React UI组件库：ant-design (antd)</h3> <blockquote><p><strong>按需引入 + 自定主题：</strong></p> <ol><li><p>安装依赖：<code>npm install react-app-rewired customize-cra babel-plugin-import less less-loader</code>;</p></li> <li><p>修改package.json</p></li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>    
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired start&quot;</span><span class="token punctuation">,</span>    
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired build&quot;</span><span class="token punctuation">,</span>    
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired test&quot;</span><span class="token punctuation">,</span>    
  <span class="token property">&quot;eject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts eject&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>根目录下创建config-overrides.js</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//配置具体的修改规则</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> override<span class="token punctuation">,</span> fixBabelImports<span class="token punctuation">,</span>addLessLoader<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'customize-cra'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">override</span><span class="token punctuation">(</span>    
  <span class="token function">fixBabelImports</span><span class="token punctuation">(</span><span class="token string">'import'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        
      libraryName<span class="token operator">:</span> <span class="token string">'antd'</span><span class="token punctuation">,</span>        
      libraryDirectory<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>        
      style<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    
  <span class="token function">addLessLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        
      lessOptions<span class="token operator">:</span><span class="token punctuation">{</span>            
          javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            
          modifyVars<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">'@primary-color'</span><span class="token operator">:</span> <span class="token string">'green'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>   
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>备注：不用在组件里亲自引入样式了，即：import 'antd/dist/antd.css'应该删掉</li></ol></blockquote> <h3 id="redux"><a href="#redux" class="header-anchor">#</a> redux</h3> <blockquote><p>redux是一个专门用于做<strong>状态管理</strong>的JS库(不是react插件库)。</p> <p>它可以用在react, angular, vue等项目中, 但基本与react配合使用；</p> <p>作用：</p> <ol><li>集中式管理react应用中<strong>多个组件共享</strong>的状态；</li> <li>一个组件需要改变另一个组件的状态 (通信)；</li></ol></blockquote> <p>工作流程原理图：</p> <p><img src="/assets/img/image-20210716222914388.ae716cb2.png" alt="image-20210716222914388"></p> <h4 id="三大核心概念"><a href="#三大核心概念" class="header-anchor">#</a> 三大核心概念：</h4> <ul><li><p><strong>store</strong>：将state、action、reducer联系在一起的对象</p> <p>创建步骤：</p> <ol><li><code>import {createStore} from 'redux'</code></li> <li><code>import reducer from './reducers'</code></li> <li><code>const store = createStore(reducer)</code></li></ol> <p>常用 API：</p> <ul><li><p><code>getState()</code>：得到 <code>state</code></p></li> <li><p><code>dispatch(action)</code>：分发 <code>action</code>，触发 <code>reducer</code> 调用, 产生新的 <code>state</code></p></li> <li><p><code>subscribe(listener)</code>：注册监听, 当产生了新的 <code>state</code> 时, 自动调用</p></li></ul></li> <li><p><strong>reducers</strong>：用于初始化状态、加工状态。</p> <p>当收到的 <code>prevState = undefined</code> 时，<code>reducer</code> 会初始化该值；</p> <p>加工时，根据旧的 <code>state</code> 和 <code>action</code>， 产生新的 <code>state</code> 的<strong>纯函数</strong>；</p></li> <li><p><strong>Action Creators</strong>：将想要对 <code>state</code> 进行的操作封装成对象</p> <ul><li><p>包含2个属性</p> <p><code>type</code>：标识属性, 值为字符串, 唯一, 必要属性</p> <p><code>data</code>：数据属性, 值类型任意, 可选属性</p></li></ul></li></ul> <h4 id="创建-redux"><a href="#创建-redux" class="header-anchor">#</a> 创建 <code>redux</code>：</h4> <ol><li><p>去除 <code>Count</code> 组件自身的状态</p></li> <li><p>在src下建立:</p> <ul><li>redux
<ul><li><code>store.js</code></li> <li><code>count_reducer.js</code></li> <li><code>count_action.js</code>：用于将对组件的操作改造为一个 <code>action</code> 对象；</li> <li><code>constant.js</code>：放置编码中容易疏忽写错的 <code>action</code> 中的 <code>type</code>；</li></ul></li></ul></li> <li><p><code>store.js</code>：</p> <ul><li>引入 <code>redux</code> 中的createStore函数，创建一个 <code>store</code></li> <li><code>createStore</code> 调用时要传入一个为其服务的 <code>reducer</code></li> <li>记得暴露 <code>store</code> 对象</li></ul></li> <li><p><code>count_reducer.js</code>：</p> <ul><li><p>reducer的本质是一个函数，接收：preState,action，返回加工后的状态</p></li> <li><p>reducer有两个作用：初始化状态，加工状态</p></li> <li><p>reducer被第一次调用时，是store自动触发的，为了初始化值：
<code>preState</code> 为 <code>undefined</code>，
<code>action</code> 为 <code>{type:'@@REDUX/INIT_a.2.b.4}</code></p></li></ul></li></ol> <p>**注意：**redux只负责管理状态，并不驱动着页面的重新 <code>render</code>；</p> <ul><li><p>解决方法一：</p> <p>因此可以在组件中使用 <code>store.subscribe(() =&gt; {})</code> 在其回调函数中书写 <code>this.setState({})</code> 在其中传入空对象，可以达到既不改变状态值，又触发页面重传的目的，但是这种方法需要给每个使用 <code>redux</code> 的对象都书写一个API，比较麻烦；</p></li> <li><p>解决方法二：</p> <p>在 <code>render &lt;APP/&gt;</code> 时，通过在 <code>store.subscribe()</code> 中书写回调函数的方式来促进页面重新渲染，该方法会监测store中状态的改变，一旦发生改变则重新渲染 <code>&lt;App/&gt;</code>；</p></li></ul> <p>异步 <code>action</code>：运用在需要异步请求，但是又不想在组件中书写请求的情况下</p> <blockquote><p>同步 <code>action</code>：返回值为一个 Object 类型的一般对象；</p> <p>异步 <code>action</code>：返回值为一个函数值，store 接收到这个函数后会自动调用执行这个函数，该函数可以接收一个参数 <code>diapatch</code>；</p></blockquote> <p>步骤：</p> <ul><li><p>在 <code>action.js</code> 中书写异步 <code>action</code>;</p></li> <li><p>由于 <code>store</code> 不识别异步函数，因此</p> <ol><li><p>安装 <code>redux-thunk</code> 依赖包；</p></li> <li><p>引入 thunk 中间件：<code>import thunk from 'redux-thunk'</code></p></li> <li><p>引入使用中间件的函数：<code>import {applyMiddleware} from 'react'</code></p></li> <li><p>将 <code>applyMiddleware(thunk)</code> 写做 <code>createStore()</code> 的第二个参数，表示运用此中间件；</p></li></ol></li></ul> <h3 id="react-redux"><a href="#react-redux" class="header-anchor">#</a> react-redux：</h3> <blockquote><p>UI组件：不能使用任何redux的api，只负责页面的呈现、交互等。</p> <p>容器组件：负责和redux通信，将结果交给UI组件。</p></blockquote> <p>创建一个容器组件：</p> <ol><li><p>安装 <code>redux</code> 依赖包；</p></li> <li><p><code>import {connect} from 'react-redux'</code></p></li> <li><p><strong><code>connect(mapStateToProps,mapDispatchToProps)(UI组件)</code></strong></p> <ul><li><code>mapStateToProps(state)</code>：映射状态，返回值是一个对象</li> <li><code>mapDispatchToProps(dispatch)</code>：映射操作状态的方法，返回值是一个对象</li></ul> <p>书写以上两个方法的目的是通过 <code>props</code> 将 <code>state 或 操作state</code> 的方法传给UI组件；</p></li></ol> <p><code>react-redux</code> 优化：</p> <ul><li><p>容器组件 和 UI组件 整合一个文件</p></li> <li><p>无需在 <code>&lt;APP&gt;</code> 中通过 Props给一个个的容器组件传递 <code>store</code>，给 <code>&lt;App/&gt;</code> 包裹一个 <code>&lt;Provider store={store}&gt;</code> 即可。</p></li> <li><p>不用再使用 <code>subscribe()</code> 检测redux中状态的改变，容器组件自动监测；</p></li> <li><p><code>mapDispatchToProps</code> 也可以简单的写成一个对象</p></li> <li><p>一个组件要和redux“打交道”要经过哪几步？</p> <ol><li><p>定义好UI组件---不暴露</p></li> <li><p>引入connect生成一个容器组件，并暴露，写法如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">connect</span><span class="token punctuation">(</span>    <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token operator">:</span>value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//映射状态    {key:xxxxxAction} //映射操作状态的方法)(UI组件)</span>
</code></pre></div></li></ol></li></ul> <p>数据共享：</p> <ul><li><p>store.js</p> <ol><li><p><code>import {combineReducers} from 'redux'</code></p></li> <li><p>将 不同的 reducer 以对象的形式储存在 store 中：<code>const allReducer = combineReducers({name: key})</code>，为了避免引入过多的 reducer，可以将所有的 reducer 引入另一个 js文件中，再将 allReducer，引入 store 中；</p></li> <li><p>此时由于 state的内容改变，不再是存储单独数据的一个一般类型，而是一个对象，因此在 connect 调用函数时，从参数中获取内容也不再是 <code>count: state</code> 而改为 <code>count: state.count</code> 才能取出需要的数据；</p></li></ol></li></ul> <p>纯函数：只要是同样的输入(实参)，必定得到同样的输出(返回)</p> <blockquote><p>遵守以下约束：</p> <ul><li><p>不得改写参数数据；</p></li> <li><p>不会产生任何副作用，例如网络请求，输入和输出设备；</p></li> <li><p>不能调用Date.now()或者Math.random()等不纯的方法 ，因为以上两个方法会使每次输出结果不相同；</p></li></ul> <p>redux 的 reducer 必须是一个纯函数；</p></blockquote> <p><code>react-redux</code> 开发者工具的使用 (自主监听 redux 中数据变化)</p> <ol><li><p><code>npm install redux-devtools-extension</code></p></li> <li><p><code>store</code> 中配置：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>composeWithDevTools<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-devtools-extension'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>allReducer<span class="token punctuation">,</span><span class="token function">composeWithDevTools</span><span class="token punctuation">(</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h3 id="react-扩展"><a href="#react-扩展" class="header-anchor">#</a> React 扩展：</h3> <ul><li><p><code>setState</code> 更新状态的两种写法：</p> <ul><li><p><code>setState(stateChange, [callback])</code> ------ 对象式的setState：</p> <ol><li><code>stateChange</code> 为状态改变对象(该对象可以体现出状态的更改)；</li> <li><code>callback</code> 是可选的回调函数, 它在状态更新完毕、界面也更新后(render调用后)才被调用；</li></ol></li> <li><p><code>setState(updater, [callback])</code> ------ 函数式的setState：</p> <ol><li><p><code>updater</code> 为返回 <code>stateChange</code> 对象的函数。</p></li> <li><p><code>updater</code> 可以接收到 <code>state</code> 和 <code>props</code>。</p></li> <li><p><code>callback</code> 与上相同；</p></li></ol></li></ul> <blockquote><p>总结：对象式的setState是函数式的setState的简写方式(语法糖)</p> <p>使用原则：</p> <ul><li>如果新状态不依赖于原状态 =&gt; 使用对象方式；</li> <li>如果新状态依赖于原状态 =&gt; 使用函数方式；</li> <li>如果需要在setState()执行后获取最新的状态数据，要在第二个callback函数中读取；</li></ul></blockquote></li> <li><p>路由组件的 LazyLoad</p> <ul><li><p>通过 <code>React</code> 的 <code>lazy</code> 函数配合 <code>import()</code> 函数动态加载路由组件 ===&gt; 路由组件代码会被分开打包
<code>const Login = React.lazy(()=&gt;import('@/pages/Login'))</code></p> <p>or</p> <p><code>const Login = lazy(()=&gt;import('./pages/Login'))</code></p> <p>第二种写法需要在 <code>react</code> 库中引入 <code>lazy</code>；</p></li> <li><p>通过 <code>&lt;Suspense&gt;</code> 指定在加载得到路由打包文件前显示一个自定义loading界面</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Suspense<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">loading.....</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/xxx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Xxxx<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/login<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Suspense</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li> <li><p><code>Hooks</code> or <code>React Hook</code></p> <blockquote><p>Hook是React 16.8.0版本增加的新特性，使用者可以在函数组件中使用 state 以及其他的 React 特性；</p></blockquote> <p>常用的三个 Hook：</p> <ul><li><p><code>State Hook: React.useState()</code></p> <blockquote><p>State Hook让函数组件也可以有state状态, 并进行状态数据的读写操作
语法:  <code>const [xxx, setXxx] = React.useState(initValue)</code></p> <p><code>useState()</code> 说明:
-- 参数: 第一次初始化指定的值在内部作缓存
-- 返回值: <strong>包含2个元素的数组, 第1个为内部当前状态值, 第2个为更新状态值的函数</strong>；</p> <p>setXxx()2种写法:</p> <ul><li>setXxx(newValue): 参数为非函数值, 直接指定新的状态值, 内部用其覆盖原来的状态值</li> <li>setXxx(value =&gt; newValue): 参数为函数, 接收原本的状态值, 返回新的状态值, 内部用其覆盖原来的状态值</li></ul></blockquote></li> <li><p><code>Effect Hook: React.useEffect()</code></p> <blockquote><p>Effect Hook 可以让你在函数组件中执行副作用操作(用于模拟类组件中的生命周期钩子)</p> <p>React中的副作用操作：</p> <ul><li>发ajax请求数据获取</li> <li>设置订阅 / 启动定时器</li> <li>手动更改真实DOM</li></ul> <p>语法和说明:</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code>React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  <span class="token comment">// 在此可以执行任何带副作用操作</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 在组件卸载前执行</span>
      <span class="token comment">// 在此做一些收尾工作, 比如清除定时器/取消订阅等</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>stateValue<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 如果指定的是[], 回调函数只会在第一次render()后执行</span>
</code></pre></div><p>可以把 useEffect Hook 看做如下三个函数的组合</p> <ul><li><code>componentDidMount()</code>：函数的第二个参数为 空数组时[]；</li> <li><code>componentDidUpdate()</code>：函数第二个参数中为 state 某个或某几个对象时；</li> <li><code>componentWillUnmount()</code>：retrun 的函数；</li></ul></blockquote></li> <li><p><code>Ref Hook: React.useRef()</code></p> <blockquote><p>Ref Hook可以在函数组件中存储/查找组件内的标签或任意其它数据</p> <p>语法：<code>const refContainer = useRef()</code></p> <p>作用：保存标签对象,功能与React.createRef()一样</p></blockquote></li></ul></li> <li><p>Fragment</p> <p>因为 jsx 规定组件只能有一个根标签，因此在组件层层嵌套时，可能会多出一些无用的嵌套根标签，此时可以使用：<code>&lt;Fragment&gt;&lt;/Fragment&gt;</code>  or <code>&lt;&gt;&lt;/&gt;</code></p> <p>在解析 React 时，浏览器会自动将这两个标签去除；</p> <p>两者的区别是，在需要遍历渲染时 <code>&lt;Fragment&gt;</code> 中可以传入 <code>key</code>，而 <code>&lt;&gt;</code> 不能传任何值；</p></li> <li><p>Context</p> <blockquote><p>一种组件间的通信方式，常用于 <strong>祖组件</strong> 和 <strong>后代组件</strong> 之间的通信；</p></blockquote> <p>使用步骤：</p> <ol><li><p>创建Context容器对象：<code>const XxxContext = React.createContext()</code></p></li> <li><p>渲染子组时，外面包裹xxxContext.Provider, 通过value属性给后代组件传递数据：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>xxxContext.Provider</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>数据<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    子组件
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>xxxContext.Provider</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>后代组件读取数据：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">//第一种方式:仅适用于类组件 </span>
<span class="token keyword">static</span> contextType <span class="token operator">=</span> xxxContext<span class="token punctuation">;</span>  <span class="token comment">// 声明接收context</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span> <span class="token comment">// 读取context中的value数据</span>

<span class="token comment">//第二种方式: 函数组件与类组件都可以</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>xxxContext.Consumer</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>
    <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span> <span class="token comment">// value就是context中的value数据</span>
    要显示的内容
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>xxxContext.Consumer</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol> <p>注意：在应用开发中一般不使用 <code>context</code>，一般都用它封装 <code>react</code> 插件，如 <code>react-redux</code> 中给容器组件传递 <code>store</code> 的 <code>&lt;Provider&gt;</code></p></li> <li><p>组件优化：</p> <blockquote><p>Component 本身自带的两个问题：</p> <ul><li>只要执行 <code>setState()</code>，即使不改变状态数据, 组件也会重新 <code>render()</code> ==&gt; 效率低；</li> <li>只当前组件重新 <code>render()</code>, 就会 自动重新 <code>render</code> 子组件，纵使子组件没有用到父组件的任何数据 ==&gt; 效率低；</li></ul> <p>原因：<code>Component</code> 中的 <code>shouldComponentUpdate()</code> 总是返回 <code>true</code></p> <p>高效率做法：</p> <p>只有当组件的 <code>state</code> 或 <code>props</code> 数据发生改变时才重新 <code>render()</code>；</p></blockquote> <p>解决办法：</p> <ul><li>方法一：
重写 <code>shouldComponentUpdate()</code> 方法，比较新旧state或props数据, 如果有变化才返回true, 如果没有返回false；</li> <li>方法二：
将 <code>Component</code> 改写为 <code>PureComponent</code>，<code>PureComponent</code> 重写了<code>shouldComponentUpdate()</code>，只有 <code>state</code> 或 <code>props</code> 数据有变化才返回 <code>true</code>；</li></ul> <p><strong>注意：</strong> <code>PureComponent</code> 只是进行 <code>state</code> 和 <code>props</code> 数据的浅比较, 如果只是数据对象内部数据变了, 返回 <code>false</code> ，因此不要直接修改 <code>state</code> 数据, 而是要产生新数据；</p></li> <li><p><code>render props</code>：</p> <blockquote><p>向组件内部动态传入带内容的结构标签 (在一个组件中动态的嵌套另一个组件)</p></blockquote> <p>两种方式：</p> <ul><li><p><code>children props</code>：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 在A组件的父组件中传入</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">A</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">B</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">xxxx</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">B</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">A</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">// 在A组件中接收</span>
<span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>

问题<span class="token operator">:</span> 如果<span class="token constant">B</span>组件需要<span class="token constant">A</span>组件内的数据<span class="token punctuation">,</span> <span class="token operator">==</span><span class="token operator">&gt;</span> 做不到 
</code></pre></div></li> <li><p><code>render props</code>：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 在A组件的父组件中定义render 函数</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">A</span></span> <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">C</span></span> <span class="token attr-name">data</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">C</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">A</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">// 在A组件中调用父组件中定义的函数，动态创建一个新组件</span>
<span class="token comment">// 在函数中传入的参数即为A组件传给新组件的props</span>
<span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>内部state数据<span class="token punctuation">)</span><span class="token punctuation">}</span>

<span class="token comment">// 在C组件中接收A组件作为参数传过来的值</span>
读取<span class="token constant">A</span>组件传入的数据显示 <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>data<span class="token punctuation">}</span> 
</code></pre></div></li></ul></li> <li><p>错误边界</p> <blockquote><p>用来捕获后代错误的组件，若后代组件出错，则渲染出备用页面，以防止一个组件出错而影响整个页面；</p> <p>特点：</p> <p>只能捕获<strong>后代组件生命周期产生的错误</strong>，不能捕获自己组件产生的错误和其他组件在合成事件、定时器中产生的错误；</p></blockquote> <p>使用方式：</p> <p><code>getDerivedStateFromError</code> 配合 <code>componentDidCatch</code></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 生命周期函数，一旦后台组件报错，就会触发</span>
<span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在render之前触发</span>
    <span class="token comment">// 返回新的state</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        hasError<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 统计页面的错误。发送请求发送到后台去</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/21/2021, 2:03:05 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/accumulate/network/cookie.html" class="prev">
        本地存储
      </a></span> <span class="next"><a href="/accumulate/frame/vue.html">
        vue
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.81d09c15.js" defer></script><script src="/assets/js/2.8398b084.js" defer></script><script src="/assets/js/13.4d0b052d.js" defer></script>
  </body>
</html>
